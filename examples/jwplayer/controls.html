<style type="text/css">
  progress {
    height:30px;
    width:960px;
  }
</style>
<div>
  <progress id="progress" value="0"></progress>
  <div>
    <button id="play">Play</button>
    <button id="pause">Pause</button>
  </div>
</div>


<script src="../../dist/ihop.js"></script>
<script type="text/javascript">
  const options = {network: {}};

  if (location.href.indexOf('transmuxer-output') !== -1) {
    options.network.parentOrigin = 'https://jrivera-projects.s3.amazonaws.com/';
    options.network.allowedOrigins = [ 'https://jrivera-projects.s3.amazonaws.com/' ];
  } else if (location.href.indexOf('jrivera-projects') !== -1) {
    options.network.parentOrigin = 'https://transmuxer-output.s3.amazonaws.com/';
    options.network.allowedOrigins = [ 'https://transmuxer-output.s3.amazonaws.com/' ];
  } else {
    options.network.parentOrigin = 'http://127.0.0.1:8080/';
    options.network.allowedOrigins = [ 'http://127.0.0.1:8080/' ];
  }
  const ihop = new IHOP('controls', options);

  // This jwplayer is in iframe "jwplayer"
  ihop.waitFor('jwplayer.player').then(async (JWPLAYER) => {
    console.debug('Found jwplayer...');

    const currTimeProg = document.querySelector('#progress');

    JWPLAYER.setMute(true);

    document.querySelector('#play').addEventListener('click', () => JWPLAYER.play());
    document.querySelector('#pause').addEventListener('click', () => JWPLAYER.pause());

    JWPLAYER.on('time', (message) => {
      const currentTime = message.position;
      const duration = message.duration;

      currTimeProg.value = currentTime / duration;
    });

    currTimeProg.addEventListener('click', async (e) => {
      const ratio = e.offsetX / currTimeProg.offsetWidth;
      const duration = await JWPLAYER.getDuration();
      const seekToTime = duration * ratio;
      JWPLAYER.seek(seekToTime);
    });
  });
</script>
